---
layout: default
title:  SVG表情
---
<!-- 
<svg width=200 height=200 viewBox="0 0 200 200" id="svgElement" stroke-width=3 fill=none stroke=green>
    <circle cx=100 cy=100 r=80 />
    <circle cx=100 cy=100 r=70 />
    <polyline points="60 80, 70 70, 80 80" />
    <polyline points="120 80, 130 70, 140 80" />
    <polyline points="90 120, 100 130, 110 120" />
</svg>
 --> 
<script type="text/javascript" src="http://g.alicdn.com/kissy/k/1.4.7/seed-min.js"></script>
<style type="text/css"> 
    #demo {
        overflow: hidden;
    }
    #demo div{
        float: left;
    } 
</style>
<div id="demo">
</div>

<script type="text/javascript">
/*
    name: SVG表情生成工具
    param:
        container: 表情加载容器（eg. #demo|.demo|document.getElement('demo')）
        level: 表情级别（0-100）
*/
function createFace(container,level){
    var face = {
        r: 80,
        x: 100,
        y: 100
    }
    function createElementNS(nodeName){
        return document.createElementNS('http://www.w3.org/2000/svg',nodeName);
    }
    /*构建画面*/
    function createSVG(){
        var svg = createElementNS('svg');
        svg.setAttribute('width',200);
        svg.setAttribute('height',200);
        svg.setAttribute('viewBox','0 0 200 200');
        svg.setAttribute('stroke',calcColor());
        svg.setAttribute('fill','none');
        svg.setAttribute('stroke-width','3');
        if (level > 0) {
            svg.appendChild(createCircle(100,100,80,10,true));
        }
        svg.appendChild(createCircle(100,100,70,5,false));
        var eyePoint = calcY(level,100,-2.5);
        var mouthPoint = calcY(level,100,2.5);
        svg.appendChild(createpolyline('50 80, 70 80, 90 80','50 80, 70 '+ (eyePoint>80?80:eyePoint) +', 90 80'));
        svg.appendChild(createpolyline('110 80, 130 80, 150 80','110 80, 130 '+ (eyePoint>80?80:eyePoint) +', 150 80'));
        svg.appendChild(createpolyline('80 120, 100 120, 120 120','80 120, 100 '+ mouthPoint +', 120 120'));
        return svg;
    }
    /*构建圆脸*/
    function createCircle(cx,cy,r,width,b){
        var circle = createElementNS('circle');
        circle.setAttribute('cx',cx);
        circle.setAttribute('cy',cy);
        circle.setAttribute('r',r);
        if (width) {
            circle.setAttribute('stroke-width',width);
        };
        if (b) {
            var perimeter = 3.14*2*r;
            var length = perimeter/100*level;
            var otherLength = perimeter-length;
            var toDasharray = length+' '+otherLength;
            var fromDasharray = '0 '+perimeter
            circle.setAttribute('stroke-dasharray',toDasharray);
            circle.appendChild(createAnimate('stroke-dasharray',fromDasharray,toDasharray));
        };
        // <animate attributeType="XML" attributeName="r" from=0 to=50 dur="1s"></animate>
        return circle;
    }
    /*构建眼睛嘴巴*/
    function createpolyline(from,to){
        var polyline = createElementNS('polyline');
        polyline.setAttribute('points',to);
        polyline.appendChild(createAnimate('points',from,to));
        return polyline;
    }
    /*构建动画*/
    function createAnimate(name,from,to){
        var animate = createElementNS('animate');
        animate.setAttribute('attributeType','XML');
        animate.setAttribute('attributeName',name);
        animate.setAttribute('from',from);
        animate.setAttribute('to',to);
        animate.setAttribute('dur','.5s');
        // animate.setAttribute('repeatCount','indefinite');
        return animate;
    }
    /*计算表情颜色*/ 
    /**
     * r:212 g:89 b:84
     * r:255 g:153 b:0
     * r:123 g:219 b:68
     */
    function calcColor(){
        var color;
        var calc = function(a,b,c){
            return Math.floor(a+(b-a)*((level-50*c)/50));
        }
        if (level <= 50) {
            color = 'rgb('+calc(212,255,0)+','+calc(89,153,0)+','+calc(84,0,0)+')'
        } else if(level < 100){
            color = 'rgb('+calc(255,123,1)+','+calc(153,219,1)+','+calc(0,68,1)+')'
        } else {
            color = 'rgb(123,219,68)'
        };
        return color;
    }
    /*计算Y轴*/
    function calcY(level,baseY,proportion){
        return baseY + Math.floor(level/proportion);
    }

    container = (typeof container == 'string') ? document.querySelector(container) : container;
    level = level > 100 ? 100 : (level < 0 ? 0 : level);
    container.innerHTML = '';
    container.appendChild(createSVG());

}

setInterval(function(){
    document.getElementById('demo').innerHTML = '';
    for (var i = 0; i <= 10; i++) {
        var div = document.createElement('div');
        createFace(div,i*10);
        document.getElementById('demo').appendChild(div);
    };
},1000);

</script>